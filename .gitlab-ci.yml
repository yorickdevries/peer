image: node:carbon

variables:
  POSTGRES_DB: peer_database
  POSTGRES_USER: postgres
  POSTGRES_PASSWORD: password

stages:
    - static-analysis
    - build
    - test
    - coverage
    
before_script:
- cd server && npm install && cd ..
- cd client && npm install && cd ..

tslint:
  stage: static-analysis
  script:
  - npm run tslint --prefix ./server
database:
  stage: build
  services:
  - postgres:10.3
  script:
  - npm run db_init --prefix ./server
build_server:
  stage: build
  script:
  - npm run build --prefix ./server
build_client:
  stage: build
  script:
  - npm run build --prefix ./client
test:
  stage: test
  services:
  - postgres:10.3
  script:
  - npm run test --prefix ./server
coverage:
  stage: coverage
  services:
  - postgres:10.3
  script:
  - npm run coverage --prefix ./server